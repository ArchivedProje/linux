# Linux

## Процессы
### Получение списка процессов
Процесс — это работающая программа. Каждому процессу в системе присвоен числовой идентификатор процесса (PID)
```sh
ps u
```
![Screenshot from 2022-05-21 21-48-05](https://user-images.githubusercontent.com/72094319/169665349-3ea359db-7590-4803-877f-e5b659544b74.png)

* _USER_ - пользователь, из-под которого был запущен процесс
* _PID_ - идентификатор процесса
* _VSZ_ - размер виртуальной памяти, выделенной под процесс (в байтах)
* _RSS_ - память, физически используемая процессом
* _TTY_ - конечное устройтсво, в котором запущен процесс
* _STAT_ - статус процесса
  + _R_ - процесс выполняется или готов к выполнению
  + _D_ - ожидает дискового ввода / вывода
  + _T_ - процесс остановлен
  + _S_ - процесс в состоянии ожидания
  + _s_ - родитель процесса (под ним дочерние)
  + _<_ - процесс с высоким приоритетом
  + _N_ - процесс с низким приоритетом
  + _+_ - группа процессов в фоновом режиме
* _TIME_ - количество веремни цп в чч:мм:сс, которое использвал данный процесс
### Завершение процесса
Для завершения процесса необходимо отправить ему сигнал
* _HUP_ (hang up) - прерывание линии (закрыть SSH сессию for example)
* _INT_ / _TERM_ / _QUIT_ (interrupt) - прервать (мб на программном уровне эти сигналы будут обрабатываться по-разному)
* _STOP_ - приостановить процесс
* _CONT_ - продолжить выполнение процесса
* _KILL_ - убить процесс и принудительно выгрузить все данные, связанные с этим процессом из памяти

```sh
kill -STOP pid
```

## Режимы файлов и права доступа
![Screenshot from 2022-05-22 20-03-54](https://user-images.githubusercontent.com/72094319/169706979-0331d6c7-6e9f-4f64-aea0-0ef6ca8c86e1.png)
![Screenshot from 2022-05-22 20-07-31](https://user-images.githubusercontent.com/72094319/169707079-f3bd1877-0d5d-429c-bd40-275bb1de8391.png)
![Screenshot from 2022-05-22 20-09-15](https://user-images.githubusercontent.com/72094319/169707151-b1b8d457-680a-4a78-86d2-d7ed7713e661.png)

* '-' - обычный файл
* d - директория
* l - символическая ссылка (по сути, как ярлык в Windows)
* r - файл доступен для чтения
* w - файл доступен для записи
* x - файл является исполняемым

### Изменение прав доступа

```sh
chmod go+r file
```
Разрешить читать файл все участникам группы (g) и остальным (o)

## Иерархия каталогов Linux
![Screenshot from 2022-05-22 20-15-14](https://user-images.githubusercontent.com/72094319/169707342-28fc82a5-a491-482e-b495-f7d8c5a82936.png)

* /bin - содержит готовые к запуску команды, большинство команд представлено в двоичном формате (т.к. созданы компилятором C)
* /dev - файлы устройств
* /etc - центральный каталог системной конфигурации (пароль, файлы загрузки, файлы устройств и тд)
* /home - личные каталоги обычных пользователей
* /lib - файлы библиотек, хранящие программный код (содержит только совместно используемые библиотеки aka динамические библиотеки)
* /proc - системная статистика
* /sys - предоставляет интерфейс устройствам и системе
* /sbin - системные исполняемые файлы
* /tmp - хранилище временных файлов
* /usr - 'половина Linux'
* /var - каталог, в котором команды хранят информацию во время исполнения
* /boot - файлы загрузчика ядра
* /media - осноная точка подключения внешних устройств
* /opt - доп ПО от сторонних разработчиков (многие системы не используют opt)

### /usr
* /include  - заголовочные файлы, для компилятора C
* /info - руководство GNU в формате info
* /local - место для установки собственного ПО
* /man - страницы руководства
* /share - файлы, которые должны работать в других типах систем Unix без потери функциональности
* /vmlinuz (/boot/vmlinuz) - ядро

## Устройства
### Файлы устройств
![Screenshot from 2022-05-22 20-56-16](https://user-images.githubusercontent.com/72094319/169708973-21f2c2f6-9f7f-473e-8a4b-216f7d96c0a0.png)
* b - блочное устройство. Программы получают доступ к данным в виде фиксированных порций. Общий объем блочного устройств известен => индексируется => процессы получают доступ к любому блоку устройства. (Example - cd диск)
* c - символьное устройство. Символьные устройства работают с потоками данных => не обладают размером. Ядро не может выполнить откат данных после отправки их устройству. (Example - принтер)
* p - именованный канал. Аналогичны символьным устройствам, но на другом конце не драйвер ядра, а другой процесс.
* s - сокет (ip + port). Зачастую используются для взаимодействия между процессами

Число перед датой - старший и младший номер устройства, помогающий ядру идентифицировать устройство.

P.S. У сетевых интерфейсов нет файловых устройств (хотя ввод-вывод осуществляется)

### sysfs
Интерфейс sysfs служит для унифицированного обзора присоединеннх устройств.
* /dev - взаимодействие с процессами
* /sys/devices - информация об устройстве

### Диски /dev/sd*
sd соответствует диску SCSI (Small Computer System Interface)

__SCSI Structure__
![Screenshot from 2022-05-23 21-21-43](https://user-images.githubusercontent.com/72094319/169882763-3b37b7f9-6a12-4949-8e9e-f85314f84d06.png)
Компьютер не взаимодействует с устройствами напрямую, сигналы посылаются в хост-адаптер. Аналогично, устройства не взаимодействуют с ПК напрямую, а посылают отклики хост-адаптеру. 
```sh
lsscsi
```
![Screenshot from 2022-05-22 21-14-27](https://user-images.githubusercontent.com/72094319/169709736-71523b47-21fe-4063-b7f9-e84919ed2966.png)
* 1 - адрес устройства в системе (номер хост-адаптера SCSI:номер шины SCSI:идентификатор устройства SCSI ID:номер логического устройства LUN (Logical Unit Number)
* 2 - описание типа устройства
* 3 - расположение файла устройства 

### Терминалы /dev/tty* /dev/pts/*
Терминал - устройство для перемещения символов между пользовательским процессом и устройством ввода-вывода.
Псевдотерминальные устройства - эмулированные терминалы; вместо обращения к реальному аппаратному средству, сдро представляет интерфейс ввода-вывода программы посредством программы.

## Source
1. How Linux Works: What Every Superuser Should Know - Brian Ward
2. https://www.pathname.com/fhs/pub/fhs-2.3.pdf
